<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Events Management</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container mt-5">
    <!-- EVENTS -->
    <h2>Events</h2>
    <form id="createEventForm" class="mb-4">
      <div class="mb-3"><label for="eventDay" class="form-label">Day</label><input type="text" class="form-control" id="eventDay" required></div>
      <div class="mb-3"><label for="eventMonth" class="form-label">Month</label><input type="text" class="form-control" id="eventMonth" required></div>
      <div class="mb-3"><label for="eventName" class="form-label">Event Name</label><input type="text" class="form-control" id="eventName" required></div>
      <div class="mb-3"><label for="eventSetting" class="form-label">Setting</label><input type="text" class="form-control" id="eventSetting" required></div>
      <div class="mb-3"><label for="eventDescription" class="form-label">Description</label><textarea class="form-control" id="eventDescription" rows="3" required></textarea></div>
      <button type="submit" class="btn btn-primary">Create Event</button>
    </form>
    <ul id="eventsList" class="list-group mb-4"></ul>
    <form id="updateEventForm" style="display:none;" class="mb-4">
      <input type="hidden" id="updateEventId">
      <div class="mb-3"><label for="updateEventDay" class="form-label">Day</label><input type="text" class="form-control" id="updateEventDay" required></div>
      <div class="mb-3"><label for="updateEventMonth" class="form-label">Month</label><input type="text" class="form-control" id="updateEventMonth" required></div>
      <div class="mb-3"><label for="updateEventName" class="form-label">Event Name</label><input type="text" class="form-control" id="updateEventName" required></div>
      <div class="mb-3"><label for="updateEventSetting" class="form-label">Setting</label><input type="text" class="form-control" id="updateEventSetting" required></div>
      <div class="mb-3"><label for="updateEventDescription" class="form-label">Description</label><textarea class="form-control" id="updateEventDescription" rows="3" required></textarea></div>
      <button type="submit" class="btn btn-success">Update Event</button>
      <button type="button" id="cancelUpdate" class="btn btn-secondary">Cancel</button>
    </form>

  <script>
const api_endpoint = 'https://fof-website-upgrade-api.onrender.com/events';
async function fetchEvents() {
  const list = document.getElementById('eventsList');
  list.innerHTML = '';
  try {
    const res = await fetch('https://fof-website-upgrade-api.onrender.com/events');
    if (!res.ok) {
      throw new Error('No response : ' + res.status);
    }
    const events = await res.json();
    events.forEach(event => {
      const li = document.createElement('li');
      li.className = 'list-group-item d-flex justify-content-between align-items-center';
      li.innerHTML = `
        <span>
          <strong>${event.eventName}</strong> (${event.day}/${event.month})<br>
          <em>Setting:</em> ${event.setting}<br>
          <em>Description:</em> ${event.description}
        </span>
        <span>
          <button class="btn btn-sm btn-info me-2 event-edit" data-id="${event.id}" data-day="${encodeURIComponent(event.day)}" data-month="${encodeURIComponent(event.month)}" data-eventname="${encodeURIComponent(event.eventName)}" data-setting="${encodeURIComponent(event.setting)}" data-description="${encodeURIComponent(event.description)}">Edit</button>
          <button class="btn btn-sm btn-danger" onclick="deleteEvent('${event.id}')">Delete</button>
        </span>
      `;
      list.appendChild(li);
    });
    // Attach event listeners for edit buttons
    document.querySelectorAll('.event-edit').forEach(btn => {
      btn.onclick = function() {
        const id = btn.getAttribute('data-id');
        const day = decodeURIComponent(btn.getAttribute('data-day'));
        const month = decodeURIComponent(btn.getAttribute('data-month'));
        const eventName = decodeURIComponent(btn.getAttribute('data-eventname'));
        const setting = decodeURIComponent(btn.getAttribute('data-setting'));
        const description = decodeURIComponent(btn.getAttribute('data-description'));
        showUpdateForm(id, day, month, eventName, setting, description);
      };
    });
  } catch (error) {
    list.innerHTML = `<li class="list-group-item list-group-item-danger">Error fetching events: ${error.message}</li>`;
    console.error('Error fetching events:', error);
  }
}

// Create event
const createForm = document.getElementById('createEventForm');
createForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  const day = document.getElementById('eventDay').value;
  const month = document.getElementById('eventMonth').value;
  const eventName = document.getElementById('eventName').value;
  const setting = document.getElementById('eventSetting').value;
  const description = document.getElementById('eventDescription').value;
  await fetch(api_endpoint, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ day, month, eventName, setting, description })
  });
  createForm.reset();
  fetchEvents();
});

// Show update form
window.showUpdateForm = function(id, day, month, eventName, setting, description) {
  const updateForm = document.getElementById('updateEventForm');
  updateForm.style.display = 'block';
  updateForm.reset();
  document.getElementById('updateEventId').value = id;
  document.getElementById('updateEventDay').value = day;
  document.getElementById('updateEventMonth').value = month;
  document.getElementById('updateEventName').value = eventName;
  document.getElementById('updateEventSetting').value = setting;
  document.getElementById('updateEventDescription').value = description;
};

document.getElementById('cancelUpdate').onclick = function() {
  document.getElementById('updateEventForm').style.display = 'none';
};

// Update event
const updateForm = document.getElementById('updateEventForm');
updateForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  const id = document.getElementById('updateEventId').value;
  const day = document.getElementById('updateEventDay').value;
  const month = document.getElementById('updateEventMonth').value;
  const eventName = document.getElementById('updateEventName').value;
  const setting = document.getElementById('updateEventSetting').value;
  const description = document.getElementById('updateEventDescription').value;
  await fetch(`${api_endpoint}/${id}`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ day, month, eventName, setting, description })
  });
  updateForm.reset();
  updateForm.style.display = 'none';
  fetchEvents();
});

// Delete event
window.deleteEvent = async function(id) {
  await fetch(`${api_endpoint}/${id}`, { method: 'DELETE' });
  fetchEvents();
};
// Initial load
fetchEvents();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
